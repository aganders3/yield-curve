<html>
  <head>
    <title>The Yield Curve</title>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script src="{{ url_for('static', filename='js/pikaday.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pikaday.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  </head>

  <body>
    <div id="content-outer">
      <h1>The Yield Curve</h1>
      <h2>{{ date }}</h2>
      <div id="content-inner">

          <div id="chart">
            <canvas id="chartCanvas"></canvas>
          </div>

          <label for="datepicker">Date:</label>
          <input type="text" id="datepicker">
          <button id="addDataset">Add Dataset</button>

      </div>

      <footer>
          <p>Created by
              <a href="https://twitter.com/aganders3">@aganders3</a>
          </p>
      </footer>
    </div>
  <script>
    var ctx = document.getElementById("chartCanvas");
    var chart = new Chart(ctx, {
        // The type of chart we want to create
        type: 'line',

        // The data for our dataset
        data: {
            labels: ["1 Month", "3 Months", "6 Months", "1 Year",
                     "2 Years", "3 Years", "5 Years", "7 Years",
                     "10 Years", "20 Years", "30 Years"],
            datasets: [{
              label: "{{ date }}",
              borderColor: 'rgb(128, 128, 255)',
              backgroundColor: 'rgba(0, 0, 0, 0)',
              data: {{ data }},
            }]
        },
        options: {}
    });
  </script>

  <script>
    var today = new Date();
    var picker = new Pikaday(
    {
        field: document.getElementById('datepicker'),
        format: 'YYYY-MM-DD',
        firstDay: 1,
        minDate: new Date(1990, 0, 1),
        maxDate: today,
        yearRange: [1989, today.getFullYear() + 1],
        disableWeekends: true
    });

    document.getElementById('addDataset').addEventListener('click', function() {
      getJSON("yields/" + picker.toString(),
        function(err, data) {
          var newDataset = {
            label: picker.toString(),
            borderColor: 'rgb(128, 128, ' + (255 - 32 * chart.data.datasets.length) + ')',
            backgroundColor: 'rgba(0, 0, 0, 0)',
            data: data.data,
            fill: false
          };

          chart.data.datasets.push(newDataset);
          window.chart.update();
        });
    });

    var getJSON = function(url, callback) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.responseType = 'json';
      xhr.onload = function() {
        var status = xhr.status;
        if (status === 200) {
          callback(null, xhr.response);
        } else {
          callback(status, xhr.response);
        }
      };

      xhr.send();
    };
  </script>
  </body>
</html>
